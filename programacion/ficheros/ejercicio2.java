import java.io.BufferedReader;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.io.InputStreamReader;

public class ejercicio2 {
    public static void main(String[] args) {
        String linea = "", nombre = "", passwd = "";
        boolean enSistema = false;
        BufferedReader br = new BufferedReader(new InputStreamReader(System.in));
        int opcion = 0;
        try {
            File archivo = new File("passwd.txt");
            FileWriter in = new FileWriter("passwd.txt", true);
            FileReader f1 = new FileReader("passwd.txt");
            BufferedReader out = new BufferedReader(f1);

            while (opcion != 3) {
                enSistema = false;
                mostrarMenu();
                System.out.print("[+] Introduzca una opción: ");
                opcion = Integer.parseInt(br.readLine());
                if (opcion < 1 || opcion > 3) {
                    throw new IOException("[!] Opción no válida");
                }
                if (opcion != 3) {
                    
                    System.out.print("[+] Introduzca el usuario: ");
                    nombre = br.readLine();
                    System.out.print("[+] Introduzca la constraseña de " + nombre + ": ");
                    passwd = br.readLine();
        
                    linea = out.readLine();
                    if (opcion == 1) {
                        while ((linea != null) && (!enSistema)) {
                            String nombreArchivo = linea.split(":")[0];
        
                            if (nombreArchivo.equals(nombre)) {
                                enSistema = true;
                            }
        
                            linea = out.readLine();
                        }
        
                        if (enSistema) {
                            System.out.println("[!] El usuario \"" + nombre + "\" ya existe en el sistema, inserta otro.");
                        } else {
                            System.out.println("[+] Añadiendo al usuario \"" + nombre + "\" con la contraseña \"" + passwd + "\".");
                            in.write(nombre + ":" + passwd + "\n");
                            in.flush();
                        }
                    } else if (opcion == 2) {
                        while ((linea != null) && (!enSistema)) {
                            String nombreArchivo = linea.split(":")[0];
                            String passwdArchivo = linea.split(":")[1];
            
                            if (nombreArchivo.equals(nombre) && passwdArchivo.equals(passwd)) {
                                enSistema = true;
                            }
            
                            linea = out.readLine();
                        }
            
                        if (enSistema) {
                            System.out.println("[+] Bienvenido " + nombre);    
                        } else {
                            System.out.println("[!] Ususario o contraseña incorrectos, intente de nuevo.");
                        }
                    }
                    System.out.print("[+] Presione enter para continuar...");
                    br.readLine();
                } else {
                    System.out.println("[+] Cerrando programa...");
                }
            }
            in.close();
            out.close();
            br.close();
        } catch (IOException e) {
            System.out.println(e);
        } catch (Exception e) {
            System.out.println("[!] Error leyendo/escribiendo fichero.");
        }
    }
    public static void mostrarMenu() throws InterruptedException{
        String[] menu = {
            " _____  _____ \n" +
            "( ___ )( ___ )\n" +
            " |   |~~|   | \n" +
            " |   |  |   | \n" +
            " |   | ||   | \n" +
            " |   | ||   | \n" +
            " |   | ||   | \n" +
            " |   | ||   | \n" +
            " |___|~~|___| \n" +
            "(_____)(_____)\n",

            " _____   _____ \n" +
            "( ___ ) ( ___ )\n" +
            " |   |~~~|   | \n" +
            " |   |  _|   | \n" +
            " |   | | |   | \n" +
            " |   | | |   | \n" +
            " |   | | |   | \n" +
            " |   | |_|   | \n" +
            " |___|~~~|___| \n" +
            "(_____) (_____)\n",

            " _____    _____ \n" +
            "( ___ )  ( ___ )\n" +
            " |   |~~~~|   | \n" +
            " |   |  __|   | \n" +
            " |   | |  |   | \n" +
            " |   | | ||   | \n" +
            " |   | | ||   | \n" +
            " |   | |_||   | \n" +
            " |___|~~~~|___| \n" +
            "(_____)  (_____)\n",

            " _____     _____ \n" +
            "( ___ )   ( ___ )\n" +
            " |   |~~~~~|   | \n" +
            " |   |  __ |   | \n" +
            " |   | |  \\|   | \n" +
            " |   | | |\\|   | \n" +
            " |   | | | |   | \n" +
            " |   | |_| |   | \n" +
            " |___|~~~~~|___| \n" +
            "(_____)   (_____)\n",

            " _____      _____ \n" +
            "( ___ )    ( ___ )\n" +
            " |   |~~~~~~|   | \n" +
            " |   |  __  |   | \n" +
            " |   | |  \\/|   | \n" +
            " |   | | |\\/|   | \n" +
            " |   | | |  |   | \n" +
            " |   | |_|  |   | \n" +
            " |___|~~~~~~|___| \n" +
            "(_____)    (_____)\n",

            " _____       _____ \n" +
            "( ___ )     ( ___ )\n" +
            " |   |~~~~~~~|   | \n" +
            " |   |  __  _|   | \n" +
            " |   | |  \\/ |   | \n" +
            " |   | | |\\/||   | \n" +
            " |   | | |  ||   | \n" +
            " |   | |_|  ||   | \n" +
            " |___|~~~~~~~|___| \n" +
            "(_____)     (_____)\n",

            " _____        _____ \n" +
            "( ___ )      ( ___ )\n" +
            " |   |~~~~~~~~|   | \n" +
            " |   |  __  __|   | \n" +
            " |   | |  \\/  |   | \n" +
            " |   | | |\\/| |   | \n" +
            " |   | | |  | |   | \n" +
            " |   | |_|  |_|   | \n" +
            " |___|~~~~~~~~|___| \n" +
            "(_____)      (_____)\n",

            " _____         _____ \n" +
            "( ___ )       ( ___ )\n" +
            " |   |~~~~~~~~~|   | \n" +
            " |   |  __  __ |   | \n" +
            " |   | |  \\/  ||   | \n" +
            " |   | | |\\/| ||   | \n" +
            " |   | | |  | ||   | \n" +
            " |   | |_|  |_||   | \n" +
            " |___|~~~~~~~~~|___| \n" +
            "(_____)       (_____)\n",

            " _____          _____ \n" +
            "( ___ )        ( ___ )\n" +
            " |   |~~~~~~~~~~|   | \n" +
            " |   |  __  __  |   | \n" +
            " |   | |  \\/  | |   | \n" +
            " |   | | |\\/| |/|   | \n" +
            " |   | | |  | | |   | \n" +
            " |   | |_|  |_|\\|   | \n" +
            " |___|~~~~~~~~~~|___| \n" +
            "(_____)        (_____)\n",

            " _____           _____ \n" +
            "( ___ )         ( ___ )\n" +
            " |   |~~~~~~~~~~~|   | \n" +
            " |   |  __  __   |   | \n" +
            " |   | |  \\/  | _|   | \n" +
            " |   | | |\\/| |/ |   | \n" +
            " |   | | |  | |  |   | \n" +
            " |   | |_|  |_|\\_|   | \n" +
            " |___|~~~~~~~~~~~|___| \n" +
            "(_____)         (_____)\n",

            " _____            _____ \n" +
            "( ___ )          ( ___ )\n" +
            " |   |~~~~~~~~~~~~|   | \n" +
            " |   |  __  __    |   | \n" +
            " |   | |  \\/  | __|   | \n" +
            " |   | | |\\/| |/ _|   | \n" +
            " |   | | |  | |  _|   | \n" +
            " |   | |_|  |_|\\__|   | \n" +
            " |___|~~~~~~~~~~~~|___| \n" +
            "(_____)          (_____)\n",

            " _____             _____ \n" +
            "( ___ )           ( ___ )\n" +
            " |   |~~~~~~~~~~~~~|   | \n" +
            " |   |  __  __     |   | \n" +
            " |   | |  \\/  | ___|   | \n" +
            " |   | | |\\/| |/ _ |   | \n" +
            " |   | | |  | |  __|   | \n" +
            " |   | |_|  |_|\\___|   | \n" +
            " |___|~~~~~~~~~~~~~|___| \n" +
            "(_____)           (_____)\n",

            " _____              _____ \n" +
            "( ___ )            ( ___ )\n" +
            " |   |~~~~~~~~~~~~~~|   | \n" +
            " |   |  __  __      |   | \n" +
            " |   | |  \\/  | ___ |   | \n" +
            " |   | | |\\/| |/ _ \\|   | \n" +
            " |   | | |  | |  __/|   | \n" +
            " |   | |_|  |_|\\___||   | \n" +
            " |___|~~~~~~~~~~~~~~|___| \n" +
            "(_____)            (_____)\n",

            " _____               _____ \n" +
            "( ___ )             ( ___ )\n" +
            " |   |~~~~~~~~~~~~~~~|   | \n" +
            " |   |  __  __       |   | \n" +
            " |   | |  \\/  | ___ _|   | \n" +
            " |   | | |\\/| |/ _ \\ |   | \n" +
            " |   | | |  | |  __/ |   | \n" +
            " |   | |_|  |_|\\___|_|   | \n" +
            " |___|~~~~~~~~~~~~~~~|___| \n" +
            "(_____)             (_____)\n",

            " _____                _____ \n" +
            "( ___ )              ( ___ )\n" +
            " |   |~~~~~~~~~~~~~~~~|   | \n" +
            " |   |  __  __        |   | \n" +
            " |   | |  \\/  | ___ _ |   | \n" +
            " |   | | |\\/| |/ _ \\ '|   | \n" +
            " |   | | |  | |  __/ ||   | \n" +
            " |   | |_|  |_|\\___|_||   | \n" +
            " |___|~~~~~~~~~~~~~~~~|___| \n" +
            "(_____)              (_____)\n",

            " _____                 _____ \n" +
            "( ___ )               ( ___ )\n" +
            " |   |~~~~~~~~~~~~~~~~~|   | \n" +
            " |   |  __  __         |   | \n" +
            " |   | |  \\/  | ___ _ _|   | \n" +
            " |   | | |\\/| |/ _ \\ '_|   | \n" +
            " |   | | |  | |  __/ | |   | \n" +
            " |   | |_|  |_|\\___|_| |   | \n" +
            " |___|~~~~~~~~~~~~~~~~~|___| \n" +
            "(_____)               (_____)\n",

            " _____                  _____ \n" +
            "( ___ )                ( ___ )\n" +
            " |   |~~~~~~~~~~~~~~~~~~|   | \n" +
            " |   |  __  __          |   | \n" +
            " |   | |  \\/  | ___ _ __|   | \n" +
            " |   | | |\\/| |/ _ \\ '_ |   | \n" +
            " |   | | |  | |  __/ | ||   | \n" +
            " |   | |_|  |_|\\___|_| ||   | \n" +
            " |___|~~~~~~~~~~~~~~~~~~|___| \n" +
            "(_____)                (_____)\n",

            " _____                   _____ \n" +
            "( ___ )                 ( ___ )\n" +
            " |   |~~~~~~~~~~~~~~~~~~~|   | \n" +
            " |   |  __  __           |   | \n" +
            " |   | |  \\/  | ___ _ __ |   | \n" +
            " |   | | |\\/| |/ _ \\ '_ \\|   | \n" +
            " |   | | |  | |  __/ | | |   | \n" +
            " |   | |_|  |_|\\___|_| |_|   | \n" +
            " |___|~~~~~~~~~~~~~~~~~~~|___| \n" +
            "(_____)                 (_____)\n",

            " _____                    _____ \n" +
            "( ___ )                  ( ___ )\n" +
            " |   |~~~~~~~~~~~~~~~~~~~~|   | \n" +
            " |   |  __  __            |   | \n" +
            " |   | |  \\/  | ___ _ __  |   | \n" +
            " |   | | |\\/| |/ _ \\ '_ \\||   | \n" +
            " |   | | |  | |  __/ | | ||   | \n" +
            " |   | |_|  |_|\\___|_| |_||   | \n" +
            " |___|~~~~~~~~~~~~~~~~~~~~|___| \n" +
            "(_____)                  (_____)\n",

            " _____                     _____ \n" +
            "( ___ )                   ( ___ )\n" +
            " |   |~~~~~~~~~~~~~~~~~~~~~|   | \n" +
            " |   |  __  __             |   | \n" +
            " |   | |  \\/  | ___ _ __  _|   | \n" +
            " |   | | |\\/| |/ _ \\ '_ \\| |   | \n" +
            " |   | | |  | |  __/ | | | |   | \n" +
            " |   | |_|  |_|\\___|_| |_|\\|   | \n" +
            " |___|~~~~~~~~~~~~~~~~~~~~~|___| \n" +
            "(_____)                   (_____)\n", 
            
            " _____                      _____ \n" +
            "( ___ )                    ( ___ )\n" +
            " |   |~~~~~~~~~~~~~~~~~~~~~~|   | \n" +
            " |   |  __  __              |   | \n" +
            " |   | |  \\/  | ___ _ __  _/|   | \n" +
            " |   | | |\\/| |/ _ \\ '_ \\| ||   | \n" +
            " |   | | |  | |  __/ | | | ||   | \n" +
            " |   | |_|  |_|\\___|_| |_|\\_|   | \n" +
            " |___|~~~~~~~~~~~~~~~~~~~~~~|___| \n" +
            "(_____)                    (_____)\n", 

            " _____                       _____ \n" +
            "( ___ )                     ( ___ )\n" +
            " |   |~~~~~~~~~~~~~~~~~~~~~~~|   | \n" +
            " |   |  __  __               |   | \n" +
            " |   | |  \\/  | ___ _ __  _/_|   | \n" +
            " |   | | |\\/| |/ _ \\ '_ \\| | |   | \n" +
            " |   | | |  | |  __/ | | | |_|   | \n" +
            " |   | |_|  |_|\\___|_| |_|\\__|   | \n" +
            " |___|~~~~~~~~~~~~~~~~~~~~~~~|___| \n" +
            "(_____)                     (_____)\n", 

            " _____                        _____ \n" +
            "( ___ )                      ( ___ )\n" +
            " |   |~~~~~~~~~~~~~~~~~~~~~~~~|   | \n" +
            " |   |  __  __              _ |   | \n" +
            " |   | |  \\/  | ___ _ __  _/_/|   | \n" +
            " |   | | |\\/| |/ _ \\ '_ \\| | ||   | \n" +
            " |   | | |  | |  __/ | | | |_||   | \n" +
            " |   | |_|  |_|\\___|_| |_|\\__,|   | \n" +
            " |___|~~~~~~~~~~~~~~~~~~~~~~~~|___| \n" +
            "(_____)                      (_____)\n", 

            " _____                         _____ \n" +
            "( ___ )                       ( ___ )\n" +
            " |   |~~~~~~~~~~~~~~~~~~~~~~~~~|   | \n" +
            " |   |  __  __              __ |   | \n" +
            " |   | |  \\/  | ___ _ __  _/_/_|   | \n" +
            " |   | | |\\/| |/ _ \\ '_ \\| | | |   | \n" +
            " |   | | |  | |  __/ | | | |_| |   | \n" +
            " |   | |_|  |_|\\___|_| |_|\\__,_|   | \n" +
            " |___|~~~~~~~~~~~~~~~~~~~~~~~~~|___| \n" +
            "(_____)                       (_____)\n", 

            " _____                          _____ \n" +
            "( ___ )                        ( ___ )\n" +
            " |   |~~~~~~~~~~~~~~~~~~~~~~~~~~|   | \n" +
            " |   |  __  __              __  |   | \n" +
            " |   | |  \\/  | ___ _ __  _/_/_ |   | \n" +
            " |   | | |\\/| |/ _ \\ '_ \\| | | ||   | \n" +
            " |   | | |  | |  __/ | | | |_| ||   | \n" +
            " |   | |_|  |_|\\___|_| |_|\\__,_||   | \n" +
            " |___|~~~~~~~~~~~~~~~~~~~~~~~~~~|___| \n" +
            "(_____)                        (_____)\n", 

            " _____                           _____ \n" +
            "( ___ )                         ( ___ )\n" +
            " |   |~~~~~~~~~~~~~~~~~~~~~~~~~~~|   | \n" +
            " |   |  __  __              __   |   | \n" +
            " |   | |  \\/  | ___ _ __  _/_/_  |   | \n" +
            " |   | | |\\/| |/ _ \\ '_ \\| | | | |   | \n" +
            " |   | | |  | |  __/ | | | |_| | |   | \n" +
            " |   | |_|  |_|\\___|_| |_|\\__,_| |   | \n" +
            " |___|~~~~~~~~~~~~~~~~~~~~~~~~~~~|___| \n" +
            "(_____)                         (_____)\n"
        }; 

        float ralentizador = 0f;
        for (String string : menu) {
            // Limpia pantalla
            System.out.print("\033[H\033[2J");  
            System.out.flush(); 
            System.out.println(string);
            Thread.sleep((int)(40*ralentizador));
            ralentizador += 0.1;
        }
        System.out.println("\t 1 -> Registrarse");
        System.out.println("\t 2 -> Validar");
        System.out.println("\t 3 -> Salir");
    }
}
